$def with (master, masterfontb, masters, glyphid, localparametersA, localparametersB, globalparams)

$var title: $master.project.projectname

<style>
  form.extended {
    background-color: white;
  }

  form.extended * {
    font-size: 10pt;
  }

</style>
<link rel="stylesheet" type="text/css" href="/static/css/slider.css"/>
<script src="http://cdnjs.cloudflare.com/ajax/libs/paper.js/0.9.9/paper.js"></script>
<script src="/static/js/bootstrap-slider.js"></script>

<div class="row">
  <div class="col-md-4">

      <h4 class="pull-right">Font A</h4>
    
      <select name="" id="" onchange="window.location=$$(this).val();" class="pull-left">
        $for m in masters:
          $if master.id == m.id:
            <option value="" selected="selected">
              Load Master $master.project.projectname $:'{0:03d}'.format(m.version)
            </option>
          $else:
            <option value="/view/$master.project.projectname/$:'{0:03d}'.format(m.version),$:'{0:03d}'.format(masterfontb.version)/$glyphid/">
            Load Master $master.project.projectname $:'{0:03d}'.format(m.version)
            </option>
      </select>

      <ul class="nav nav-tabs" style="clear: both;">
          <li class="active"><a href="#tab-view-canvas-a" data-toggle="tab">View</a></li>
          <li><a href="#tab-point-canvas-a" data-toggle="tab">Point</a></li>
          <li><a href="#tab-settings-canvas-a" data-toggle="tab">Settings</a></li>
      </ul>

      <div class="tab-content">
          <div class="tab-pane active" id="tab-view-canvas-a">
              <canvas id="canvas-a" width="350" height="600"></canvas>

              <div class="canvas-a" style="display: none;">
                <a href="javascript:;" command="apply" class="btn btn-xs btn-success">Apply</a>
                <a href="javascript:;" command="cancel" class="btn btn-xs btn-danger">Cancel</a>
              </div>

              <div class="well">
                <h4>Parameters Font A <small><a href="/view/$master.project.projectname/$:'{0:03d}'.format(master.version),$:'{0:03d}'.format(masterfontb.version)/$glyphid/settings/">change</a></small></h4>

                $if not localparametersA:
                  <div class="label label-danger">This font has not specified local parameters</div>
                $else:
                  <div style="font-family: monospace; ">
                    px: $localparametersA.px<br />
                    width: $localparametersA.width<br />
                    space: $localparametersA.space<br />
                    xheight: $localparametersA.xheight<br />
                    capital: $localparametersA.capital<br />
                    ascender: $localparametersA.ascender<br />
                    descender: $localparametersA.descender<br />
                    skeleton: $localparametersA.skeleton<br />
                    over: $localparametersA.over
                  </div>
              </div>
          </div>
          <div class="tab-pane fade" id="tab-point-canvas-a">
              <form action="" method="post" class="extended">
                  $:webctx.pointparam_extended_form.render()
              </form>
          </div>
          <div class="tab-pane fade" id="tab-settings-canvas-a">
              <form action="" method="post">
                  $:webctx.settings_forma.render()
              </form>
          </div>
      </div>

  </div>

  <div class="col-md-4">
    <h4>Metapolation</h4>

    <a href="/view/$master.project.projectname/$:'{0:03d}'.format(master.version),$:'{0:03d}'.format(masterfontb.version)/create/" class="btn btn-xs btn-success">Create master from instance</a>
    
    <canvas width="350" height="600" id="canvas-m"></canvas>

    <div class="well">
      <h4>Global Parameters <small><a href="/view/$master.project.projectname/$:'{0:03d}'.format(master.version),$:'{0:03d}'.format(masterfontb.version)/$glyphid/settings/">change</a></small></h4>

      $if not globalparams:
        <div class="label label-danger">This font has not specified global parameters</div>
      $else:
        <div style="font-family: monospace;">
          metapolation: $globalparams.metapolation<br />
          unitwidth: $globalparams.unitwidth<br />
          fontsize: $globalparams.fontsize<br />
          mean: $globalparams.mean<br />
          cap: $globalparams.cap<br />
          ascl: $globalparams.ascl<br />
          des: $globalparams.des<br />
          box: $globalparams.box
        </div>
    </div>

    <div style="margin-bottom: 16px;" class="row">
       <div class="col-md-2" style="text-align: center; font-size: 21pt;">A</div>
       <div class="col-md-8" style="text-align: center; padding-top: 8pt;">
        <input class="slider1" type="text" value="" data-slider-min="0" data-slider-max="1" data-slider-step="0.1" data-slider-value="$:(globalparams and globalparams.metapolation or 0)" data-slider-orientation="horizontal" data-slider-selection="after" data-slider-tooltip="show" data-slider-handle="square">
      </div>
      <div class="col-md-2" style="text-align: center; font-size: 21pt;">B</div>
    </div>

    <div style="margin-bottom: 16px;" class="row">
       <div class="col-md-2" style="text-align: center; font-size: 21pt;">C</div>
       <div class="col-md-8" style="text-align: center; padding-top: 8pt;">
        <input class="slider1" type="text" value="" data-slider-min="0" data-slider-max="1" data-slider-step="0.1" data-slider-value="$:(globalparams and globalparams.metapolation or 0)" data-slider-orientation="horizontal" data-slider-selection="after" data-slider-tooltip="hide" data-slider-handle="square">
      </div>
      <div class="col-md-2" style="text-align: center; font-size: 21pt;">D</div>
    </div>

    <div style="margin-bottom: 16px;" class="row">
       <div class="col-md-2" style="text-align: center; font-size: 21pt;">A</div>
       <div class="col-md-8" style="text-align: center; padding-top: 8pt;">
        <input class="slider1" type="text" value="" data-slider-min="0" data-slider-max="1" data-slider-step="0.1" data-slider-value="$:(globalparams and globalparams.metapolation or 0)" data-slider-orientation="horizontal" data-slider-selection="after" data-slider-tooltip="hide" data-slider-handle="square">
      </div>
      <div class="col-md-2" style="text-align: center; font-size: 21pt;">E</div>
    </div>
  </div>

  <div class="col-md-4">

    <h4 class="pull-right">Font B</h4>
    
      <select name="" id="" onchange="window.location=$$(this).val();" class="pull-left">
        $for m in masters:
          $if master.id == m.id:
            <option value="" selected="selected">
              Load Master $master.project.projectname $:'{0:03d}'.format(m.version)
            </option>
          $else:
            <option value="/view/$master.project.projectname/$:'{0:03d}'.format(m.version),$:'{0:03d}'.format(masterfontb.version)/$glyphid/">
            Load Master $master.project.projectname $:'{0:03d}'.format(m.version)
            </option>
      </select>

      <ul class="nav nav-tabs" style="clear: both;">
          <li class="active"><a href="#tab-view-canvas-b" data-toggle="tab">View</a></li>
          <li><a href="#tab-point-canvas-b" data-toggle="tab">Point</a></li>
          <li><a href="#tab-settings-canvas-b" data-toggle="tab">Settings</a></li>
      </ul>

      <div class="tab-content">
          <div class="tab-pane active" id="tab-view-canvas-b">
              <canvas id="canvas-b" width="350" height="600"></canvas>

              <div class="canvas-b" style="display: none;">
                <a href="javascript:;" command="apply" class="btn btn-xs btn-success">Apply</a>
                <a href="javascript:;" command="cancel" class="btn btn-xs btn-danger">Cancel</a>
              </div>

              <div class="well">
                <h4>Parameters Font A <small><a href="/view/$master.project.projectname/$:'{0:03d}'.format(master.version),$:'{0:03d}'.format(masterfontb.version)/$glyphid/settings/">change</a></small></h4>

                $if not localparametersA:
                  <div class="label label-danger">This font has not specified local parameters</div>
                $else:
                  <div style="font-family: monospace;">
                    px: $localparametersA.px<br />
                    width: $localparametersA.width<br />
                    space: $localparametersA.space<br />
                    xheight: $localparametersA.xheight<br />
                    capital: $localparametersA.capital<br />
                    ascender: $localparametersA.ascender<br />
                    descender: $localparametersA.descender<br />
                    skeleton: $localparametersA.skeleton<br />
                    over: $localparametersA.over
                  </div>
              </div>
          </div>
          <div class="tab-pane fade" id="tab-point-canvas-b">
              <form action="" method="post" class="extended">
                  $:webctx.pointparam_extended_form.render()
              </form>
          </div>
          <div class="tab-pane fade" id="tab-settings-canvas-b">
              <form action="" method="post">
                  $:webctx.settings_formb.render()
              </form>
          </div>
      </div>
    
  </div>
</div>

<script src="/static/js/canvas.js" type="text/javascript"></script>
<script type="text/javascript">
jQuery(
  function(){

    $$.post('', {})
      .success(function(data){
        var data = $$.parseJSON(data);
        var M_canvas = new Canvas('canvas-m', data.glyphs.M.width, data.glyphs.A.height);
        M_canvas.renderGlyph(data.glyphs.A.edges);
        M_canvas.draw();

        var A_canvas = new Canvas('canvas-a', data.glyphs.A.width, data.glyphs.A.height, 'a');
        A_canvas.setZpoints(data.zpoints.A);
        A_canvas.renderGlyph(data.glyphs.A.edges);
        A_canvas.showbox();
        A_canvas.onGlyphLoaded = M_canvas.redrawglyph.bind(M_canvas);
        A_canvas.draw();

        var B_canvas = new Canvas('canvas-b', data.glyphs.B.width, data.glyphs.B.height, 'b');
        B_canvas.setZpoints(data.zpoints.B);
        B_canvas.renderGlyph(data.glyphs.B.edges);
        B_canvas.showbox();
        B_canvas.onGlyphLoaded = M_canvas.redrawglyph.bind(M_canvas);
        B_canvas.draw();

      })
      .fail(function(){alert('Bad response');})

    $$('.slider1').slider();
    $$('.slider2').slider();
    $$('.slider3').slider();
  }
);

</script>