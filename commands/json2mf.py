mflist = ['A', 'Agrave', 'Aacute', 'Acircumflex', 'Atilde', 'Adieresis', 'Aring', 'Amacron', 'Abreve', 'Aogonek', 'B', 'uni1E02', 'C', 'Ccedilla', 'Cacute', 'Ccircumflex', 'Cdotaccent', 'Ccaron', 'D', 'Dcaron', 'uni1E0A', 'E', 'Egrave', 'Eacute', 'Ecircumflex', 'Edieresis', 'Emacron', 'Edotaccent', 'Eogonek', 'Ecaron', 'F', 'uni1E1E', 'G', 'Gcircumflex', 'Gbreve', 'Gdotaccent', 'Gcommaaccent', 'H', 'Hcircumflex', 'I', 'Igrave', 'Iacute', 'Icircumflex', 'Idieresis', 'Itilde', 'Imacron', 'Iogonek', 'Idotaccent', 'J', 'Jcircumflex', 'K', 'Kcommaaccent', 'L', 'Lacute', 'Lcommaaccent', 'Lcaron', 'M', 'uni1E40', 'N', 'Ntilde', 'Nacute', 'Ncommaaccent', 'Ncaron', 'O', 'Ograve', 'Oacute', 'Ocircumflex', 'Otilde', 'Odieresis', 'Omacron', 'Ohungarumlaut', 'P', 'uni1E56', 'Q', 'R', 'Racute', 'Rcommaaccent', 'Rcaron', 'S', 'Sacute', 'Scircumflex', 'Scedilla', 'Scaron', 'uni1E60', 'T', 'Tcommaaccent', 'Tcaron', 'uni1E6A', 'U', 'Ugrave', 'Uacute', 'Ucircumflex', 'Udieresis', 'Utilde', 'Umacron', 'Ubreve', 'Uring', 'Uhungarumlaut', 'Uogonek', 'V', 'W', 'Wcircumflex', 'Wgrave', 'Wacute', 'Wdieresis', 'X', 'Y', 'Yacute', 'Ycircumflex', 'Ydieresis', 'Ygrave', 'Z', 'Zacute', 'Zdotaccent', 'Zcaron', 'AE', 'Eth', 'Oslash', 'Thorn', 'Dcroat', 'Hbar', 'Lslash', 'Eng', 'OE', 'Tbar', 'M.salt', 'uni1E40.salt', 'N.salt', 'Ntilde.salt', 'Nacute.salt', 'Ncommaaccent.salt', 'Ncaron.salt', 'X.salt', 'Idotaccent.smcp', 'uni03A9', 'mu', 'afii61289', 'a', 'agrave', 'aacute', 'acircumflex', 'atilde', 'adieresis', 'aring', 'amacron', 'abreve', 'aogonek', 'b', 'uni1E03', 'c', 'ccedilla', 'cacute', 'ccircumflex', 'cdotaccent', 'ccaron', 'c_h', 'c_k', 'c_t', 'd', 'dcaron', 'uni1E0B', 'e', 'egrave', 'eacute', 'ecircumflex', 'edieresis', 'emacron', 'edotaccent', 'eogonek', 'ecaron', 'f', 'uni1E1F', 'f_t', 'f_y', 'g', 'gcircumflex', 'gbreve', 'gdotaccent', 'gcommaaccent', 'h', 'hcircumflex', 'i', 'igrave', 'iacute', 'icircumflex', 'idieresis', 'itilde', 'imacron', 'iogonek', 'j', 'jcircumflex', 'k', 'kcommaaccent', 'l', 'lacute', 'lcommaaccent', 'lcaron', 'm', 'uni1E41', 'n', 'ntilde', 'nacute', 'ncommaaccent', 'ncaron', 'o', 'ograve', 'oacute', 'ocircumflex', 'otilde', 'odieresis', 'omacron', 'ohungarumlaut', 'p', 'uni1E57', 'q', 'r', 'racute', 'rcommaaccent', 'rcaron', 's', 'sacute', 'scircumflex', 'scedilla', 'scaron', 'uni1E61', 't', 'tcommaaccent', 'tcaron', 'uni1E6B', 't_t', 't_y', 'u', 'ugrave', 'uacute', 'ucircumflex', 'udieresis', 'utilde', 'umacron', 'ubreve', 'uring', 'uhungarumlaut', 'uogonek', 'v', 'w', 'wcircumflex', 'wgrave', 'wacute', 'wdieresis', 'x', 'y', 'yacute', 'ydieresis', 'ycircumflex', 'ygrave', 'z', 'zacute', 'zdotaccent', 'zcaron', 'ordfeminine', 'ordmasculine', 'germandbls', 'ae', 'eth', 'oslash', 'thorn', 'dcroat', 'hbar', 'dotlessi', 'kgreenlandic', 'lslash', 'eng', 'oe', 'tbar', 'florin', 'uniFB00', 'uniFB01', 'uniFB02', 'uniFB03', 'uniFB04', 'uniFB06', 'a.salt', 'agrave.salt', 'aacute.salt', 'acircumflex.salt', 'atilde.salt', 'adieresis.salt', 'aring.salt', 'amacron.salt', 'abreve.salt', 'aogonek.salt', 'b.salt', 'uni1E03.salt', 'd.salt', 'dcaron.salt', 'uni1E0B.salt', 'f.salt', 'uni1E1F.salt', 'g.salt', 'gcircumflex.salt', 'gbreve.salt', 'gdotaccent.salt', 'gcommaaccent.salt', 'm.salt', 'uni1E41.salt', 'n.salt', 'ntilde.salt', 'nacute.salt', 'ncommaaccent.salt', 'ncaron.salt', 'p.salt', 'uni1E57.salt', 'r.salt', 'racute.salt', 'rcommaaccent.salt', 'rcaron.salt', 't.salt', 'tcommaaccent.salt', 'tcaron.salt', 'u.salt', 'ugrave.salt', 'uacute.salt', 'ucircumflex.salt', 'udieresis.salt', 'utilde.salt', 'umacron.salt', 'ubreve.salt', 'uring.salt', 'uhungarumlaut.salt', 'uogonek.salt', 'x.salt', 'dcroat.salt', 'tbar.salt', 'a.smcp', 'agrave.smcp', 'aacute.smcp', 'acircumflex.smcp', 'atilde.smcp', 'adieresis.smcp', 'aring.smcp', 'amacron.smcp', 'abreve.smcp', 'aogonek.smcp', 'b.smcp', 'uni1E03.smcp', 'c.smcp', 'ccedilla.smcp', 'cacute.smcp', 'ccircumflex.smcp', 'cdotaccent.smcp', 'ccaron.smcp', 'd.smcp', 'dcaron.smcp', 'uni1E0B.smcp', 'e.smcp', 'egrave.smcp', 'eacute.smcp', 'ecircumflex.smcp', 'edieresis.smcp', 'emacron.smcp', 'edotaccent.smcp', 'eogonek.smcp', 'ecaron.smcp', 'f.smcp', 'uni1E1F.smcp', 'g.smcp', 'gcircumflex.smcp', 'gbreve.smcp', 'gdotaccent.smcp', 'gcommaaccent.smcp', 'h.smcp', 'hcircumflex.smcp', 'i.smcp', 'igrave.smcp', 'iacute.smcp', 'icircumflex.smcp', 'idieresis.smcp', 'itilde.smcp', 'imacron.smcp', 'iogonek.smcp', 'j.smcp', 'jcircumflex.smcp', 'k.smcp', 'kcommaaccent.smcp', 'l.smcp', 'lacute.smcp', 'lcommaaccent.smcp', 'lcaron.smcp', 'm.smcp', 'uni1E41.smcp', 'n.smcp', 'ntilde.smcp', 'nacute.smcp', 'ncommaaccent.smcp', 'ncaron.smcp', 'o.smcp', 'ograve.smcp', 'oacute.smcp', 'ocircumflex.smcp', 'otilde.smcp', 'odieresis.smcp', 'omacron.smcp', 'ohungarumlaut.smcp', 'p.smcp', 'uni1E57.smcp', 'q.smcp', 'r.smcp', 'racute.smcp', 'rcommaaccent.smcp', 'rcaron.smcp', 's.smcp', 'sacute.smcp', 'scircumflex.smcp', 'scedilla.smcp', 'scaron.smcp', 'uni1E61.smcp', 't.smcp', 'tcommaaccent.smcp', 'tcaron.smcp', 'uni1E6B.smcp', 'u.smcp', 'ugrave.smcp', 'uacute.smcp', 'ucircumflex.smcp', 'udieresis.smcp', 'utilde.smcp', 'umacron.smcp', 'ubreve.smcp', 'uring.smcp', 'uhungarumlaut.smcp', 'uogonek.smcp', 'v.smcp', 'w.smcp', 'wcircumflex.smcp', 'wgrave.smcp', 'wacute.smcp', 'wdieresis.smcp', 'x.smcp', 'y.smcp', 'yacute.smcp', 'ydieresis.smcp', 'ycircumflex.smcp', 'ygrave.smcp', 'z.smcp', 'zacute.smcp', 'zdotaccent.smcp', 'zcaron.smcp', 'ordfeminine.smcp', 'ordmasculine.smcp', 'germandbls.smcp', 'ae.smcp', 'eth.smcp', 'oslash.smcp', 'thorn.smcp', 'dcroat.smcp', 'hbar.smcp', 'lslash.smcp', 'eng.smcp', 'oe.smcp', 'tbar.smcp', 'a.superior', 'b.superior', 'c.superior', 'd.superior', 'e.superior', 'f.superior', 'g.superior', 'h.superior', 'i.superior', 'j.superior', 'k.superior', 'l.superior', 'm.superior', 'n.superior', 'o.superior', 'p.superior', 'q.superior', 'r.superior', 's.superior', 't.superior', 'u.superior', 'v.superior', 'w.superior', 'x.superior', 'y.superior', 'z.superior', 'pi', 'circumflex', 'caron', 'circumflex.smcp', 'caron.smcp', 'uni0338', 'zero', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine', 'zero.denominator', 'one.denominator', 'two.denominator', 'three.denominator', 'four.denominator', 'five.denominator', 'six.denominator', 'seven.denominator', 'eight.denominator', 'nine.denominator', 'zero.numerator', 'one.numerator', 'two.numerator', 'three.numerator', 'four.numerator', 'five.numerator', 'six.numerator', 'seven.numerator', 'eight.numerator', 'nine.numerator', 'zero.oldstyle', 'one.oldstyle', 'two.oldstyle', 'three.oldstyle', 'four.oldstyle', 'five.oldstyle', 'six.oldstyle', 'seven.oldstyle', 'eight.oldstyle', 'nine.oldstyle', 'zero.smcp', 'one.smcp', 'two.smcp', 'three.smcp', 'four.smcp', 'five.smcp', 'six.smcp', 'seven.smcp', 'eight.smcp', 'nine.smcp', 'zero.tnum', 'one.tnum', 'two.tnum', 'three.tnum', 'four.tnum', 'five.tnum', 'six.tnum', 'seven.tnum', 'eight.tnum', 'nine.tnum', 'zero.tosf', 'one.tosf', 'two.tosf', 'three.tosf', 'four.tosf', 'five.tosf', 'six.tosf', 'seven.tosf', 'eight.tosf', 'nine.tosf', 'uni00B2', 'uni00B3', 'uni00B9', 'onequarter', 'onehalf', 'threequarters', 'uni2070', 'uni2074', 'uni2075', 'uni2076', 'uni2077', 'uni2078','uni2079', 'uni2080', 'uni2081', 'uni2082', 'uni2083', 'uni2084', 'uni2085', 'uni2086', 'uni2087', 'uni2088', 'uni2089', 'underscore', 'hyphen', 'endash', 'emdash', 'hyphen.alt', 'endash.alt', 'emdash.alt', 'hyphen.smcp', 'endash.smcp', 'emdash.smcp', 'parenleft', 'bracketleft', 'braceleft', 'quotesinglbase', 'quotedblbase', 'parenleft.alt', 'parenleft.smcp', 'quotesinglbase.smcp', 'quotedblbase.smcp', 'parenright', 'bracketright', 'braceright', 'parenright.alt', 'parenright.smcp', 'guillemotleft', 'quoteleft', 'quotedblleft', 'guilsinglleft', 'quoteleft.smcp', 'quotedblleft.smcp', 'guillemotright', 'quoteright', 'quotedblright', 'guilsinglright', 'quoteright.smcp', 'quotedblright.smcp', 'exclam', 'quotedbl', 'numbersign', 'percent', 'ampersand', 'quotesingle', 'asterisk', 'comma', 'period', 'slash', 'colon', 'semicolon', 'question', 'at', 'backslash', 'exclamdown', 'periodcentered', 'questiondown', 'dagger', 'daggerdbl', 'bullet', 'ellipsis', 'perthousand', 'at.alt', 'exclamdown.alt', 'questiondown.alt', 'ampersand.salt', 'exclam.smcp', 'quotedbl.smcp', 'numbersign.smcp', 'percent.smcp', 'ampersand.smcp', 'quotesingle.smcp', 'asterisk.smcp', 'question.smcp', 'at.smcp', 'exclamdown.smcp', 'periodcentered.smcp', 'questiondown.smcp', 'bullet.smcp', 'perthousand.smcp', 'plus', 'less', 'equal', 'greater', 'bar', 'asciitilde', 'logicalnot', 'plusminus', 'multiply', 'divide', 'fraction', 'partialdiff', 'Delta', 'product', 'summation', 'minus', 'radical', 'infinity', 'integral', 'approxequal', 'notequal', 'lessequal', 'greaterequal', 'dollar', 'cent', 'sterling', 'currency', 'yen', 'Euro', 'dollar.smcp', 'sterling.smcp', 'yen.smcp', 'Euro.smcp', 'asciicircum', 'grave', 'dieresis', 'macron', 'acute', 'cedilla', 'breve', 'dotaccent', 'ring', 'ogonek', 'tilde', 'hungarumlaut', 'grave.smcp', 'dieresis.smcp', 'macron.smcp', 'acute.smcp', 'ring.smcp', 'tilde.smcp', 'brokenbar', 'section', 'copyright', 'registered', 'degree', 'paragraph', 'afii61352', 'trademark', 'estimated', 'lozenge', 'degree.smcp', 'space', '.notdef', 'uni000D', 'uni00AD', 'uni00AD.alt', 'uni00AD.smcp', 'onesuperior', 'threesuperior', 'twosuperior']


def json2mf(glyphname, axes):
    """ Returns metafont formatted content for interpolated glyph

        Arguments:

        glyphname:  # Name of glyph to lookup in each masters
        axes:  # Dictionary with axis values of masters pair.
            [<master>, <master>]

            master dictionary described as

                master:
                    axis:
                        [<float>, <float>]
                    name:
                        <string>
                    glyphs:
                        [<glyph>]

                glyph:
                    name:
                        <string>
                    contours:
                        [<point>]

                point:
                    start:
                      <bool>
                    x:
                    y:
                      <float>
                    x1:
                    y1:
                    x2:
                    y2:
                      <float>

        Each metapolated point is calculated by next function:

        sum(axis<Lpx * LExtra + value * (Rpx * RExtra - Lpx * LExtra)>)
    """
    divider = 1  # len(axes)

    content = ''
    listwidth = '{W1}*{A1}_width + {AXIS} * ({W2}*{A2}_width - {W1}*{A1}_width)'

    beginfontchar = []
    for axis in axes:
        lmaster = axis['masters'][0]
        rmaster = axis['masters'][1]

        lglyph = lmaster['glyphs'][glyphname]
        rglyph = rmaster['glyphs'][glyphname]
        beginfontchar.append(listwidth.format(W1='%.2f' % (lglyph['advanceWidth'] / 100.),
                                              W2='%.2f' % (rglyph['advanceWidth'] / 100.),
                                              AXIS=axis['alias'],
                                              A1=lmaster['alias'],
                                              A2=rmaster['alias']))

    begin = 'beginfontchar ({g}, (({args}) / 1 + spacing_{g}R) * width_{g}, 0, 0 );\n'
    content += begin.format(args=' + '.join(beginfontchar), g=mflist.index(glyphname) + 1)

    coordstr = '{Ap} + {metapolation} * ({Bp} - {Ap})'
    coords = []  # Z points

    for axis in axes:
        lglyph = axis['masters'][0]['glyphs'][glyphname]
        rglyph = axis['masters'][1]['glyphs'][glyphname]

        for i, point in enumerate(lglyph['points']):
            if len(coords) <= i:
                coords.append({'x': [], 'y': [],
                               'controls_x1': [], 'controls_y1': [],
                               'controls_x2': [], 'controls_y2': []})
            coords[i]['x'].append(coordstr.format(Ap=point['x'],
                                                  metapolation=axis['alias'],
                                                  Bp=rglyph['points'][i]['x']))
            coords[i]['y'].append(coordstr.format(Ap=point['y'],
                                                  metapolation=axis['alias'],
                                                  Bp=rglyph['points'][i]['y']))
            if point.get('start'):
                coords[i]['start'] = True

            if 'x1' in point:
                coords[i]['controls_x1'].append(coordstr.format(Ap=point['x1'],
                                                                metapolation=axis['alias'],
                                                                Bp=rglyph['points'][i]['x1']))
                coords[i]['controls_y1'].append(coordstr.format(Ap=point['y1'],
                                                                metapolation=axis['alias'],
                                                                Bp=rglyph['points'][i]['y1']))

            if 'x2' in point:
                coords[i]['controls_x2'].append(coordstr.format(Ap=point['x2'],
                                                                metapolation=axis['alias'],
                                                                Bp=rglyph['points'][i]['x2']))
                coords[i]['controls_y2'].append(coordstr.format(Ap=point['y2'],
                                                                metapolation=axis['alias'],
                                                                Bp=rglyph['points'][i]['y2']))

    # zpoints = []
    for i, zcoords in enumerate(coords):
        content += 'z%s = (((%s) / %s), ((%s) / %s));\n' % (
            i + 1,
            ' + '.join(zcoords['x']),
            divider,
            ' + '.join(zcoords['y']),
            divider)

        if zcoords['controls_x1']:
            content += 'c1_%s = (((%s) / %s), ((%s) / %s));\n' % (
                i + 1,
                ' + '.join(zcoords['controls_x1']),
                divider,
                ' + '.join(zcoords['controls_y1']),
                divider)

        if zcoords['controls_x2']:
            content += 'c2_%s = (((%s) / %s), ((%s) / %s));\n' % (
                i + 1,
                ' + '.join(zcoords['controls_x2']),
                divider,
                ' + '.join(zcoords['controls_y2']),
                divider)

    # % penstrokes
    # fill
    # z1 .. controls z2 and  z3 .. cycle;
    # endchar;
    for i, zcoord in enumerate(coords):
        if zcoord.get('start'):
            content += 'fill\n'
        content += 'z%s' % (i + 1)
        if zcoord['controls_x1']:
            content += ' .. controls c1_%s' % (i + 1)
            if zcoord['controls_x2']:
                content += ' and c2_%s' % (i + 1)
            else:
                content += ' and c1_%s' % (i + 1)
        try:
            if coords[i + 1].get('start'):
                content += ' cycle;\n'
            else:
                content += ' .. '
        except IndexError:
            content += ' .. cycle;\n'

    content += 'endchar;'

    return content


